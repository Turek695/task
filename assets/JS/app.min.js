const srcFile="./products.json";var products=[],productsQty=0,productsIndex=0,chosenStat="all";function showProducts(products,filter="all",index){let lazyCounter=0;if("all"==filter){for(;index<=productsQty;index++)if(console.log(index,productsQty),makeProductContainer(products[index]),lazyCounter+=1,lazyCounter>=12||index==productsQty)return console.log(`productsIndex = ${index+1}`),productsIndex=index+1}else for(;index<=productsQty;index++)if(products[index].prod_status&&products[index].prod_status.includes(filter)&&(console.log(index,productsQty),makeProductContainer(products[index]),lazyCounter+=1),lazyCounter>=12||index==productsQty)return console.log(`productsIndex = ${index+1}`),productsIndex=index+1}function makeProductContainer(prod){if($("<div class='prod-cont'></div>").appendTo(".gallery__wrapper"),$("<div class='prod-cont__stat-img'></div>").appendTo(".prod-cont:last"),$("<div class='prod-cont__stats-cont'></div>").appendTo(".prod-cont__stat-img:last"),prod.prod_status)if(prod.prod_status.indexOf(",")<0)$(`<h4 class="prod-cont__stat-label">${prod.prod_status}</h4>`).appendTo($(".prod-cont__stats-cont:last"));else{let arr=prod.prod_status.split(",");$.each(arr,(function(j,item){$(`<h4 class="prod-cont__stat-label">${item}</h4 > `).appendTo($(".prod-cont__stats-cont:last"))}))}$("<img class='prod-cont__prod-img' loading='auto' src='assets/images/placeholder.png' alt='product image'>").appendTo($(".prod-cont__stat-img:last")),$("<div class='prod-cont__name-price'></div>").appendTo(".prod-cont:last"),$(`<h3 class='prod-cont__prod-name'>${prod.prod_id}. ${prod.prod_name}</h3 >`).appendTo($(".prod-cont__name-price:last")),$(`<span class='prod-cont__prod-price'>${prod.prod_price} z≈Ç</span>`).appendTo($(".prod-cont__name-price:last"))}$.getJSON(srcFile,{}).done((function(data){products=data,productsQty=Object.keys(products).length-2,$(".gallery__wrapper").empty(),showProducts(products,chosenStat,productsIndex),lastContainerObserver.observe(document.querySelector(".prod-cont:last-child"))})).fail((function(){alert("Ajax call failed.")})),$("#stat-sel").change((function(){chosenStat=(chosenStat=$(this).find(":selected").text()).toLowerCase(),productsIndex=0,$(".gallery__wrapper").empty(),showProducts(products,chosenStat,productsIndex),lastContainerObserver.observe(document.querySelector(".prod-cont:last-child"))}));const lastContainerObserver=new IntersectionObserver(entries=>{const lastContainer=entries[0];lastContainer.isIntersecting&&(showProducts(products,chosenStat,productsIndex),lastContainerObserver.unobserve(lastContainer.target),lastContainerObserver.observe(document.querySelector(".prod-cont:last-child")))},{root:null,threshold:0});